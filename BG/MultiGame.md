# 多人实时对战编写指导

---

## 一、基本流程

1. **创建房间**
2. **通过输入房间号进行匹配**
3. **选择角色**
4. **开始游戏**

---

### 游戏循环流程

- **5.1 开始阶段**
  Buff 或 Debuff 生效期
- **5.2 准备阶段**
  利用当前手牌进行操作
- **5.3 判定阶段**
  给出的手牌进行结算

*循环执行上述阶段，直到游戏结束*

---

6. **结束游戏**
   - 6.1 记录对局
   - 6.2 销毁房间
   - 6.3 跳转页面

---

## 二、重要的前后端交互节点与数据传输

### 1. 创建房间

- **前端发送**：创建房间的用户 `uid`
- **后端返回**：房间设置信息，并将对应的 `string-room` 添加到 `map` 中

---

### 2. 通过房间号进行匹配

- 用户输入房间号后自动进入
- **前端调用**：`joinRoom`
- **后端返回**：新的 `room`，并进行同步更新

---

### 3. 选择角色

- 双方用户盲选角色
- 需要进行同步和广播

---

### 4. 开始游戏

- 初始化玩家数据，随机分发卡牌
- 后端返回特定的 `user` 类
- 利用 WebSocket 维护实时通信

---

### 5.1 Buff/Debuff 状态结算

- 前端发送房间号
- 后端计算状态（效果与持续回合数），返回新的 `player` 数据

---

### 5.2 准备阶段

- 玩家利用当前手牌进行操作（无需额外处理）

---

### 5.3 判定阶段

- 结算时前端发送所有用户信息到后端，自动处理：
  1. 状态性手牌结算
  2. 防御性手牌结算
  3. 攻击性手牌结算

> **算法思想**：
> 拆解为原子操作，复杂操作由原子操作组合，增强代码复用
- 然后同步所有计算好的数据到前端和内存中

---

### 6.1-6.2
- 想法就是调用finish函数就行了，再在finish里面集成
